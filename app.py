# -*- coding: utf-8 -*-

import os
import sys
import requests
from flask import Flask, request, abort
from linebot.v3 import WebhookHandler
from linebot.v3.messaging import (
    Configuration, ApiClient, MessagingApi,
    ReplyMessageRequest, TextMessage
)
from linebot.v3.webhooks import (
    MessageEvent, TextMessageContent
)
from linebot.v3.exceptions import InvalidSignatureError

app = Flask(__name__)

# ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—
channel_secret = os.getenv('LINE_CHANNEL_SECRET')
channel_access_token = os.getenv('LINE_CHANNEL_ACCESS_TOKEN')
if channel_secret is None or channel_access_token is None:
    print("ç’°å¢ƒå¤‰æ•°ãŒè¶³ã‚Šã¾ã›ã‚“")
    sys.exit(1)

handler = WebhookHandler(channel_secret)
configuration = Configuration(access_token=channel_access_token)

# è‹±èªãƒãƒƒãƒ—åâ†’æ—¥æœ¬èªãƒãƒƒãƒ—åã®è¾æ›¸
MAP_TRANSLATIONS = {
    "World's Edge": "ãƒ¯ãƒ¼ãƒ«ã‚ºã‚¨ãƒƒã‚¸",
    "Fragment East": "ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆãƒ»ã‚¤ãƒ¼ã‚¹ãƒˆ",
    "Fragment West": "ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆãƒ»ã‚¦ã‚¨ã‚¹ãƒˆ",
	"Fragment": "ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆ",
    "Storm Point": "ã‚¹ãƒˆãƒ¼ãƒ ãƒã‚¤ãƒ³ãƒˆ",
    "Broken Moon": "ãƒ–ãƒ­ãƒ¼ã‚¯ãƒ³ãƒ ãƒ¼ãƒ³",
    "Olympus": "ã‚ªãƒªãƒ³ãƒ‘ã‚¹",
    "Kings Canyon": "ã‚­ãƒ³ã‚°ã‚¹ã‚­ãƒ£ãƒ‹ã‚ªãƒ³",
    "Thunderdome": "ã‚µãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ¼ãƒ ",
    "Overflow": "ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼",
    "Habitat 4": "ç”Ÿæ¯åœ°4",
    "Encore": "ã‚¢ãƒ³ã‚³ãƒ¼ãƒ«",
    "Production Yard": "ç”Ÿç”£å·¥å ´",
    "Skulltown": "ã‚¹ã‚«ãƒ«ã‚¿ã‚¦ãƒ³",
    "Monument": "ãƒ¢ãƒ‹ãƒ¥ãƒ¡ãƒ³ãƒˆ",
    "E-District": "ã‚¨ãƒ¬ã‚¯ãƒˆãƒ­åœ°åŒº",
    "Siphon": "ãƒ©ãƒã‚µã‚¤ãƒ•ã‚©ãƒ³",
    "Estates": "ã‚¨ã‚¹ãƒ†ãƒ¼ãƒˆ",
    "Control": "ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«", # ãƒ¢ãƒ¼ãƒ‰å
    "Gun Run": "ã‚¬ãƒ³ã‚²ãƒ¼ãƒ ",
    "Team Deathmatch": "ãƒãƒ¼ãƒ ãƒ‡ã‚¹ãƒãƒƒãƒ",
    "Unknown": "ä¸æ˜ã€ã‚¨ãƒ©ãƒ¼"
}

# æ­¦å™¨ã®è¿”ç­”è¾æ›¸
WEAPON_RESPONSES = {
    "?ãƒãƒœãƒƒã‚¯": (
        "ğŸ”« ãƒãƒœãƒƒã‚¯ãƒ©ã‚¤ãƒ•ãƒ«\n"
		"- çŸ­ç¸®å: ãƒãƒœãƒƒã‚¯\n"
		"- æ­¦å™¨ç¨®: ã‚¢ã‚µãƒ«ãƒˆãƒ©ã‚¤ãƒ•ãƒ«\n"
		"- ä½¿ç”¨ã‚¢ãƒ¢: ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚¢ãƒ¢\n"
		"- è£½é€ å…ƒ(å…±åŒé–‹ç™º): ì‹œì™„(Siwhan) Industries\n"
		"- è£½é€ å…ƒ(å…±åŒé–‹ç™º): Wonyeon\n"
		"- å°„æ’ƒãƒ¢ãƒ¼ãƒ‰: ãƒ•ãƒ«ã‚ªãƒ¼ãƒˆ(/å˜ç™º)\n"
		"- é€£å°„é€Ÿåº¦: 11.2ç™º/ç§’\n"
		"- ãƒ€ãƒ¡ãƒ¼ã‚¸: ç´ 20 é ­26 è„š15\n"
		"- è£…å¡«æ•°: ç´ 18 ç™½21 é’25 ç´«29\n"
		"- ãƒªãƒ­ãƒ¼ãƒ‰æ™‚é–“(ç§’): ç´ 3.20 ç™½3.09 é’2.99 ç´«2.88\n"
		"- ã‚¹ãƒ”ãƒ³ã‚¢ãƒƒãƒ—æ™‚é–“(ç§’): ç´ 0.42 ã‚¿ãƒœãƒãƒ£0.01\n"
		"- å¼¾é€Ÿ: ç´„774ãƒ¡ãƒ¼ãƒˆãƒ«/ç§’\n"
		"- åˆå–ã‚Šå‡ºã—ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“: 1.5ç§’\n"
		"- ãƒ˜ãƒƒãƒ‰ã‚·ãƒ§ãƒƒãƒˆæœ‰åŠ¹è·é›¢: 300ãƒ¡ãƒ¼ãƒˆãƒ«\n"
		"- ADSæ™‚ç§»å‹•é€Ÿåº¦å€ç‡: x0.5"
    ),
    "?ãƒ˜ãƒ ãƒ­ãƒƒã‚¯": (
		"ğŸ”« ãƒ˜ãƒ ãƒ­ãƒƒã‚¯ãƒãƒ¼ã‚¹ãƒˆAR\n"
		"- çŸ­ç¸®å: ãƒ˜ãƒ ãƒ­ãƒƒã‚¯\n"
		"- æ­¦å™¨ç¨®: ã‚¢ã‚µãƒ«ãƒˆãƒ©ã‚¤ãƒ•ãƒ«\n"
		"- ä½¿ç”¨ã‚¢ãƒ¢: ãƒ˜ãƒ“ãƒ¼ã‚¢ãƒ¢\n"
		"- è£½é€ å…ƒ: Wonyeon\n"
		"- å°„æ’ƒãƒ¢ãƒ¼ãƒ‰: 3ç‚¹ãƒãƒ¼ã‚¹ãƒˆ/å˜ç™º\n"
		"- é€£å°„é€Ÿåº¦(ãƒãƒ¼ã‚¹ãƒˆ): 15.5ç™º/ç§’\n"
		"- ãƒãƒ¼ã‚¹ãƒˆé€£å°„ãƒ‡ã‚£ãƒ¬ã‚¤: 0.28ç§’\n"
		"- é€£å°„é€Ÿåº¦(å˜ç™º): 6.4ç™º/ç§’\n"
		"- ãƒ€ãƒ¡ãƒ¼ã‚¸: ç´ 20 é ­26 è„š15\n"
		"- è£…å¡«æ•°: ç´ 21 ç™½24 é’27 ç´«30\n"
		"- ã‚¿ã‚¯ãƒ†ã‚£ã‚«ãƒ«ãƒªãƒ­ãƒ¼ãƒ‰æ™‚é–“(ç§’): ç´ 2.40 ç™½2.32 é’2.24 ç´«2.16\n"
		"- ãƒ•ãƒ«ãƒªãƒ­ãƒ¼ãƒ‰æ™‚é–“(ç§’): ç´ 2.85 ç™½2.76 é’2.66 ç´«2.57\n"
		"- å¼¾é€Ÿ: ç´„698ãƒ¡ãƒ¼ãƒˆãƒ«/ç§’\n"
		"- åˆå–ã‚Šå‡ºã—ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“: 1.25ç§’\n"
		"- ãƒ˜ãƒƒãƒ‰ã‚·ãƒ§ãƒƒãƒˆæœ‰åŠ¹è·é›¢: 300ãƒ¡ãƒ¼ãƒˆãƒ«\n"
		"- ADSæ™‚ç§»å‹•é€Ÿåº¦å€ç‡: x0.5"
    ),
    "?ãƒ•ãƒ©ãƒƒãƒˆãƒ©ã‚¤ãƒ³": (
        "ğŸ”« VK-47ãƒ•ãƒ©ãƒƒãƒˆãƒ©ã‚¤ãƒ³\n"
		"- çŸ­ç¸®å: ãƒ•ãƒ©ãƒƒãƒˆãƒ©ã‚¤ãƒ³\n"
		"- æ­¦å™¨ç¨®: ã‚¢ã‚µãƒ«ãƒˆãƒ©ã‚¤ãƒ•ãƒ«\n"
		"- ä½¿ç”¨ã‚¢ãƒ¢: ãƒ˜ãƒ“ãƒ¼ã‚¢ãƒ¢\n"
		"- è£½é€ å…ƒ: Wonyeon\n"
		"- å°„æ’ƒãƒ¢ãƒ¼ãƒ‰: ãƒ•ãƒ«ã‚ªãƒ¼ãƒˆ/å˜ç™º\n"
		"- é€£å°„é€Ÿåº¦(å…±é€š): 10ç™º/ç§’\n"
		"- é€£å°„é€Ÿåº¦(ã‚¢ãƒ³ãƒ“ãƒ«ãƒ»å˜ç™º): 2.9ç™º/ç§’\n"
		"- ãƒ€ãƒ¡ãƒ¼ã‚¸: ç´ 19 é ­25 è„š14\n"
		"- è£…å¡«æ•°: ç´ 19 ç™½23 é’27 ç´«29\n"
		"- ã‚¿ã‚¯ãƒ†ã‚£ã‚«ãƒ«ãƒªãƒ­ãƒ¼ãƒ‰æ™‚é–“(ç§’): ç´ 2.40 ç™½2.32 é’2.24 ç´«2.16\n"
		"- ãƒ•ãƒ«ãƒªãƒ­ãƒ¼ãƒ‰æ™‚é–“(ç§’): ç´ 3.10 ç™½3.00 é’2.89 ç´«2.79\n"
		"- å¼¾é€Ÿ: ç´„609ãƒ¡ãƒ¼ãƒˆãƒ«/ç§’\n"
		"- åˆå–ã‚Šå‡ºã—ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“: 1.25ç§’\n"
		"- ãƒ˜ãƒƒãƒ‰ã‚·ãƒ§ãƒƒãƒˆæœ‰åŠ¹è·é›¢: 300ãƒ¡ãƒ¼ãƒˆãƒ«\n"
		"- ADSæ™‚ç§»å‹•é€Ÿåº¦å€ç‡: x0.5"
    ),
	"?R-301": (
        "ğŸ”« R-301ã‚«ãƒ¼ãƒ“ãƒ³\n"
		"- çŸ­ç¸®å: R-301\n"
		"- æ­¦å™¨ç¨®: ã‚¢ã‚µãƒ«ãƒˆãƒ©ã‚¤ãƒ•ãƒ«\n"
		"- ä½¿ç”¨ã‚¢ãƒ¢: ãƒ©ã‚¤ãƒˆã‚¢ãƒ¢\n"
		"- è£½é€ å…ƒ: Lastimosa Armory\n"
		"- å°„æ’ƒãƒ¢ãƒ¼ãƒ‰: ãƒ•ãƒ«ã‚ªãƒ¼ãƒˆ/å˜ç™º\n"
		"- é€£å°„é€Ÿåº¦(å…±é€š): 13.5ç™º/ç§’\n"
		"- é€£å°„é€Ÿåº¦(ã‚¢ãƒ³ãƒ“ãƒ«ãƒ»å˜ç™º): 3.5ç™º/ç§’\n"
		"- ãƒ€ãƒ¡ãƒ¼ã‚¸: ç´ 14 é ­28 è„š11\n"
		"- è£…å¡«æ•°: ç´ 21 ç™½23 é’28 ç´«31\n"
		"- ã‚¿ã‚¯ãƒ†ã‚£ã‚«ãƒ«ãƒªãƒ­ãƒ¼ãƒ‰æ™‚é–“(ç§’): ç´ 2.40 ç™½2.32 é’2.24 ç´«2.16\n"
		"- ãƒ•ãƒ«ãƒªãƒ­ãƒ¼ãƒ‰æ™‚é–“(ç§’): ç´ 3.2 ç™½3.09 é’2.99 ç´«2.88\n"
		"- å¼¾é€Ÿ: ç´„736ãƒ¡ãƒ¼ãƒˆãƒ«/ç§’\n"
		"- åˆå–ã‚Šå‡ºã—ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“: 1.1ç§’\n"
		"- ãƒ˜ãƒƒãƒ‰ã‚·ãƒ§ãƒƒãƒˆæœ‰åŠ¹è·é›¢: 300ãƒ¡ãƒ¼ãƒˆãƒ«\n"
		"- ADSæ™‚ç§»å‹•é€Ÿåº¦å€ç‡: x0.5"
    ),
	"?ãƒãƒ¡ã‚·ã‚¹": (
        "ğŸ”« ãƒãƒ¡ã‚·ã‚¹ãƒãƒ¼ã‚¹ãƒˆAR\n"
		"- çŸ­ç¸®å: ãƒãƒ¡ã‚·ã‚¹\n"
		"- æ­¦å™¨ç¨®: ã‚¢ã‚µãƒ«ãƒˆãƒ©ã‚¤ãƒ•ãƒ«\n"
		"- ä½¿ç”¨ã‚¢ãƒ¢: ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚¢ãƒ¢\n"
		"- è£½é€ å…ƒ(ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼): ãƒ©ãƒ³ãƒ‘ãƒ¼ãƒˆ\n"
		"- è£½é€ å…ƒ: The Sisters\n"
		"- å°„æ’ƒãƒ¢ãƒ¼ãƒ‰: 4ç‚¹ãƒãƒ¼ã‚¹ãƒˆ\n"
		"- é€£å°„é€Ÿåº¦(å…±é€š): 18ç™º/ç§’\n"
		"- ãƒãƒ¼ã‚¹ãƒˆé€£å°„ãƒ‡ã‚£ãƒ¬ã‚¤(é–‹å§‹æ™‚): 0.31ç§’\n"
		"- ãƒãƒ¼ã‚¹ãƒˆé€£å°„ãƒ‡ã‚£ãƒ¬ã‚¤(æœ€å¤§æ™‚): 0.19ç§’\n"
		"- ãƒ€ãƒ¡ãƒ¼ã‚¸: ç´ 17 é ­22 è„š13\n"
		"- è£…å¡«æ•°: ç´ 20 ç™½24 é’28 ç´«32\n"
		"- ã‚¿ã‚¯ãƒ†ã‚£ã‚«ãƒ«ãƒªãƒ­ãƒ¼ãƒ‰æ™‚é–“(ç§’): ç´ 2.70 ç™½2.61 é’2.52 ç´«2.43\n"
		"- ãƒ•ãƒ«ãƒªãƒ­ãƒ¼ãƒ‰æ™‚é–“(ç§’): ç´ 3.00 ç™½2.90 é’2.80 ç´«2.70\n"
		"- å¼¾é€Ÿ: ç´„812ãƒ¡ãƒ¼ãƒˆãƒ«/ç§’\n"
		"- åˆå–ã‚Šå‡ºã—ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“: 1.3ç§’\n"
		"- ãƒ˜ãƒƒãƒ‰ã‚·ãƒ§ãƒƒãƒˆæœ‰åŠ¹è·é›¢: 300ãƒ¡ãƒ¼ãƒˆãƒ«\n"
		"- ADSæ™‚ç§»å‹•é€Ÿåº¦å€ç‡: x0.5"
    ),
	"?ã‚ªãƒ«ã‚¿ãƒãƒ¼ã‚¿ãƒ¼": (
        "ğŸ”« ã‚ªãƒ«ã‚¿ãƒãƒ¼ã‚¿ãƒ¼SMG\n"
		"- çŸ­ç¸®å: ã‚ªãƒ«ã‚¿ãƒãƒ¼ã‚¿ãƒ¼\n"
		"- æ­¦å™¨ç¨®: ã‚µãƒ–ãƒã‚·ãƒ³ã‚¬ãƒ³\n"
		"- ä½¿ç”¨ã‚¢ãƒ¢: ãƒ©ã‚¤ãƒˆã‚¢ãƒ¢\n"
		"- è£½é€ å…ƒ: Burrell Defense\n"
		"- å°„æ’ƒãƒ¢ãƒ¼ãƒ‰: ãƒ•ãƒ«ã‚ªãƒ¼ãƒˆ\n"
		"- é€£å°„é€Ÿåº¦: 10ç™º/ç§’\n"
		"- ãƒ€ãƒ¡ãƒ¼ã‚¸: ç´ 18 é ­23 è„š14\n"
		"- è£…å¡«æ•°: ç´ 20 ç™½24 é’27 ç´«29\n"
		"- ã‚¿ã‚¯ãƒ†ã‚£ã‚«ãƒ«ãƒªãƒ­ãƒ¼ãƒ‰æ™‚é–“(ç§’): ç´ 1.90 ç™½1.84 é’1.77 ç´«1.71\n"
		"- ãƒ•ãƒ«ãƒªãƒ­ãƒ¼ãƒ‰æ™‚é–“(ç§’): ç´ 2.23 ç™½2.16 é’2.08 ç´«2.01\n"
		"- å¼¾é€Ÿ: ç´„482ãƒ¡ãƒ¼ãƒˆãƒ«/ç§’\n"
		"- åˆå–ã‚Šå‡ºã—ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“: 1.2ç§’\n"
		"- ãƒ˜ãƒƒãƒ‰ã‚·ãƒ§ãƒƒãƒˆæœ‰åŠ¹è·é›¢: 38ãƒ¡ãƒ¼ãƒˆãƒ«\n"
		"- ADSæ™‚ç§»å‹•é€Ÿåº¦å€ç‡: x0.75"
	),
	"?ãƒ—ãƒ©ã‚¦ãƒ©ãƒ¼": (
        "ğŸ”« ãƒ—ãƒ©ã‚¦ãƒ©ãƒ¼ãƒãƒ¼ã‚¹ãƒˆPDW\n"
		"- çŸ­ç¸®å: ãƒ—ãƒ©ã‚¦ãƒ©ãƒ¼\n"
		"- æ­¦å™¨ç¨®: ã‚µãƒ–ãƒã‚·ãƒ³ã‚¬ãƒ³\n"
		"- ä½¿ç”¨ã‚¢ãƒ¢: ãƒ˜ãƒ“ãƒ¼ã‚¢ãƒ¢\n"
		"- è£½é€ å…ƒ: Lastimosa Armory\n"
		"- å°„æ’ƒãƒ¢ãƒ¼ãƒ‰: 5ç‚¹ãƒãƒ¼ã‚¹ãƒˆ/ãƒ•ãƒ«ã‚ªãƒ¼ãƒˆ\n"
		"- é€£å°„é€Ÿåº¦(ãƒãƒ¼ã‚¹ãƒˆ): 21ç™º/ç§’\n"
		"- ãƒãƒ¼ã‚¹ãƒˆå°„æ’ƒãƒ‡ã‚£ãƒ¬ã‚¤: 0.28ç§’\n"
		"- é€£å°„é€Ÿåº¦(ãƒ•ãƒ«ã‚ªãƒ¼ãƒˆ): 13.25ç™º/ç§’\n"
		"- ãƒ€ãƒ¡ãƒ¼ã‚¸: ç´ 16 é ­20 è„š13\n"
		"- è£…å¡«æ•°: ç´ 20 ç™½25 é’30 ç´«35\n"
		"- ã‚¿ã‚¯ãƒ†ã‚£ã‚«ãƒ«ãƒªãƒ­ãƒ¼ãƒ‰æ™‚é–“(ç§’): ç´ 2.00 ç™½1.93 é’1.87 ç´«1.80\n"
		"- ãƒ•ãƒ«ãƒªãƒ­ãƒ¼ãƒ‰æ™‚é–“(ç§’): ç´ 2.60 ç™½2.51 é’2.43 ç´«2.34\n"
		"- å¼¾é€Ÿ: ç´„457ãƒ¡ãƒ¼ãƒˆãƒ«/ç§’\n"
		"- åˆå–ã‚Šå‡ºã—ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“: 1.4ç§’\n"
		"- ãƒ˜ãƒƒãƒ‰ã‚·ãƒ§ãƒƒãƒˆæœ‰åŠ¹è·é›¢: 38ãƒ¡ãƒ¼ãƒˆãƒ«\n"
		"- ADSæ™‚ç§»å‹•é€Ÿåº¦å€ç‡: x0.75"
	),
	"?R-99": (
        "ğŸ”« R-99 SMG\n"
		"- çŸ­ç¸®å: R-99\n"
		"- æ­¦å™¨ç¨®: ã‚µãƒ–ãƒã‚·ãƒ³ã‚¬ãƒ³\n"
		"- ä½¿ç”¨ã‚¢ãƒ¢: ãƒ©ã‚¤ãƒˆã‚¢ãƒ¢\n"
		"- è£½é€ å…ƒ: Lastimosa Armory\n"
		"- å°„æ’ƒãƒ¢ãƒ¼ãƒ‰: ãƒ•ãƒ«ã‚ªãƒ¼ãƒˆ\n"
		"- é€£å°„é€Ÿåº¦: 18ç™º/ç§’\n"
		"- ãƒ€ãƒ¡ãƒ¼ã‚¸: ç´ 13 é ­16 è„š10\n"
		"- è£…å¡«æ•°: ç´ 18 ç™½21 é’24 ç´«27\n"
		"- ã‚¿ã‚¯ãƒ†ã‚£ã‚«ãƒ«ãƒªãƒ­ãƒ¼ãƒ‰æ™‚é–“(ç§’): ç´ 1.80 ç™½1.74 é’1.68 ç´«1.62\n"
		"- ãƒ•ãƒ«ãƒªãƒ­ãƒ¼ãƒ‰æ™‚é–“(ç§’): ç´ 2.45 ç™½2.37 é’2.29 ç´«2.21\n"
		"- å¼¾é€Ÿ: ç´„482ãƒ¡ãƒ¼ãƒˆãƒ«/ç§’\n"
		"- åˆå–ã‚Šå‡ºã—ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“: 1.0ç§’\n"
		"- ãƒ˜ãƒƒãƒ‰ã‚·ãƒ§ãƒƒãƒˆæœ‰åŠ¹è·é›¢: 38ãƒ¡ãƒ¼ãƒˆãƒ«\n"
		"- ADSæ™‚ç§»å‹•é€Ÿåº¦å€ç‡: x0.825"
	),
	"?ãƒœãƒ«ãƒˆ": (
        "ğŸ”« ãƒœãƒ«ãƒˆSMG\n"
		"- çŸ­ç¸®å: ãƒœãƒ«ãƒˆ\n"
		"- æ­¦å™¨ç¨®: ã‚µãƒ–ãƒã‚·ãƒ³ã‚¬ãƒ³\n"
		"- ä½¿ç”¨ã‚¢ãƒ¢: ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚¢ãƒ¢\n"
		"- è£½é€ å…ƒ: ä¸è©³\n"
		"- å°„æ’ƒãƒ¢ãƒ¼ãƒ‰: ãƒ•ãƒ«ã‚ªãƒ¼ãƒˆ\n"
		"- é€£å°„é€Ÿåº¦: 12ç™º/ç§’\n"
		"- ãƒ€ãƒ¡ãƒ¼ã‚¸: ç´ 16 é ­20 è„š12\n"
		"- è£…å¡«æ•°: ç´ 20 ç™½22 é’24 ç´«27\n"
		"- ã‚¿ã‚¯ãƒ†ã‚£ã‚«ãƒ«ãƒªãƒ­ãƒ¼ãƒ‰æ™‚é–“(ç§’): ç´ 1.44 ç™½1.39 é’1.34 ç´«1.3\n"
		"- ãƒ•ãƒ«ãƒªãƒ­ãƒ¼ãƒ‰æ™‚é–“(ç§’): ç´ 2.03 ç™½1.96 é’1.89 ç´«1.83\n"
		"- å¼¾é€Ÿ: ç´„596ãƒ¡ãƒ¼ãƒˆãƒ«/ç§’\n"
		"- åˆå–ã‚Šå‡ºã—ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“: 1.0ç§’\n"
		"- ãƒ˜ãƒƒãƒ‰ã‚·ãƒ§ãƒƒãƒˆæœ‰åŠ¹è·é›¢: 38ãƒ¡ãƒ¼ãƒˆãƒ«\n"
		"- ADSæ™‚ç§»å‹•é€Ÿåº¦å€ç‡: x0.75"
	),
	"?CAR": (
        "ğŸ”« C.A.R. SMG\n"
		"- çŸ­ç¸®å: R-99\n"
		"- æ­¦å™¨ç¨®: ã‚µãƒ–ãƒã‚·ãƒ³ã‚¬ãƒ³\n"
		"- ä½¿ç”¨ã‚¢ãƒ¢: ãƒ˜ãƒ“ãƒ¼ã‚¢ãƒ¢/ãƒ©ã‚¤ãƒˆã‚¢ãƒ¢\n"
		"- è£½é€ å…ƒ: ì‹œì™„(Siwhan) Industries\n"
		"- å°„æ’ƒãƒ¢ãƒ¼ãƒ‰: ãƒ•ãƒ«ã‚ªãƒ¼ãƒˆ\n"
		"- é€£å°„é€Ÿåº¦: 15.4ç™º/ç§’\n"		
		"- ãƒ€ãƒ¡ãƒ¼ã‚¸: ç´ 14 é ­18 è„š11\n"
		"- è£…å¡«æ•°: ç´ 20 ç™½23 é’25 ç´«28\n"
		"- ã‚¿ã‚¯ãƒ†ã‚£ã‚«ãƒ«ãƒªãƒ­ãƒ¼ãƒ‰æ™‚é–“(ç§’): ç´ 1.70 ç™½1.64 é’1.59 ç´«1.53\n"
		"- ãƒ•ãƒ«ãƒªãƒ­ãƒ¼ãƒ‰æ™‚é–“(ç§’): ç´ 2.13 ç™½2.06 é’1.99 ç´«1.92\n"
		"- å¼¾é€Ÿ: ç´„456ãƒ¡ãƒ¼ãƒˆãƒ«/ç§’\n"
		"- åˆå–ã‚Šå‡ºã—ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“: 1.1ç§’\n"
		"- ãƒ˜ãƒƒãƒ‰ã‚·ãƒ§ãƒƒãƒˆæœ‰åŠ¹è·é›¢: 38ãƒ¡ãƒ¼ãƒˆãƒ«\n"
		"- ADSæ™‚ç§»å‹•é€Ÿåº¦å€ç‡: x0.75"
    )
}


def translate_map_name(name):
    return MAP_TRANSLATIONS.get(name, name)

@app.route("/callback", methods=['POST'])
def callback():
    signature = request.headers['X-Line-Signature']
    body = request.get_data(as_text=True)
    app.logger.info("Request body: " + body)

    try:
        handler.handle(body, signature)
    except InvalidSignatureError:
        abort(400)

    return "OK"

@handler.add(MessageEvent, message=TextMessageContent)
def handle_message(event):
    user_message = event.message.text.strip()
    reply_text = None  # åˆæœŸåŒ–

    with ApiClient(configuration) as api_client:
        line_bot_api = MessagingApi(api_client)

        if user_message == "?ãƒãƒƒãƒ—":
            api_key = os.getenv("APEX_API_KEY")
            url = f"https://api.mozambiquehe.re/maprotation?auth={api_key}&version=2"

            try:
                response = requests.get(url)
                data = response.json()
                app.logger.info("APIãƒ¬ã‚¹ãƒãƒ³ã‚¹: %s", data)

                reply_lines = []

                # ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«
                if "battle_royale" in data:
                    br = data["battle_royale"]
                    reply_lines.append("\U0001F5FA ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«")
                    reply_lines.append(f"ç¾åœ¨ã®ãƒãƒƒãƒ—: {translate_map_name(br['current']['map'])}ï¼ˆã‚ã¨{br['current']['remainingTimer']}ï¼‰")
                    reply_lines.append(f"æ¬¡ã®ãƒãƒƒãƒ—: {translate_map_name(br['next']['map'])}")
                    reply_lines.append("")

                # ãƒ©ãƒ³ã‚¯
                if "ranked" in data:
                    rk = data["ranked"]
                    reply_lines.append("\U0001F3C6 ãƒ©ãƒ³ã‚¯ãƒªãƒ¼ã‚°")
                    reply_lines.append(f"ç¾åœ¨ã®ãƒãƒƒãƒ—: {translate_map_name(rk['current']['map'])}ï¼ˆã‚ã¨{rk['current']['remainingTimer']}ï¼‰")
                    reply_lines.append(f"æ¬¡ã®ãƒãƒƒãƒ—: {translate_map_name(rk['next']['map'])}")
                    reply_lines.append("")

                # LTM
                if "ltm" in data:
                    ltm = data["ltm"]
                    cur_mode = ltm["current"]
                    next_mode = ltm["next"]
                    known_mix = ["Control", "Gun Run", "Team Deathmatch"]
                    if cur_mode["eventName"] in known_mix:
                        reply_lines.append("\U0001F3AE ãƒŸãƒƒã‚¯ã‚¹ãƒ†ãƒ¼ãƒ—")
                        reply_lines.append(f"ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰: {translate_map_name(cur_mode['eventName'])}ï¼ˆãƒãƒƒãƒ—: {translate_map_name(cur_mode['map'])}ã€ã‚ã¨{cur_mode['remainingTimer']}ï¼‰")
                        reply_lines.append(f"æ¬¡ã®ãƒ¢ãƒ¼ãƒ‰: {translate_map_name(next_mode['eventName'])}ï¼ˆãƒãƒƒãƒ—: {translate_map_name(next_mode['map'])}ï¼‰")
                        reply_lines.append("")
                    else:
                        reply_lines.append("â± æœŸé–“é™å®šãƒ¢ãƒ¼ãƒ‰")
                        reply_lines.append(f"ç¾åœ¨: {translate_map_name(cur_mode['eventName'])}ï¼ˆãƒãƒƒãƒ—: {translate_map_name(cur_mode['map'])}ã€ã‚ã¨{cur_mode['remainingTimer']}ï¼‰")
                        reply_lines.append(f"æ¬¡: {translate_map_name(next_mode['eventName'])}ï¼ˆãƒãƒƒãƒ—: {translate_map_name(next_mode['map'])}ï¼‰")
                        reply_lines.append("")
                else:
                    reply_lines.append("â± æœŸé–“é™å®šãƒ¢ãƒ¼ãƒ‰")
                    reply_lines.append("ç¾åœ¨: âŒ é–‹å‚¬ã•ã‚Œã¦ã„ã¾ã›ã‚“")

                reply_text = "\n".join(reply_lines)

            except Exception as e:
                app.logger.error(f"APIã‚¨ãƒ©ãƒ¼: {e}")
                reply_text = "APIã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å¾Œã§ã‚‚ã†ä¸€åº¦è©¦ã—ã¦ãã ã•ã„ã€‚"

        elif user_message in WEAPON_RESPONSES:
            reply_text = WEAPON_RESPONSES[user_message]

        else:
            return  # ãã‚Œä»¥å¤–ã¯ç„¡è¦–

        if reply_text:
            line_bot_api.reply_message_with_http_info(
                ReplyMessageRequest(
                    reply_token=event.reply_token,
                    messages=[TextMessage(text=reply_text)]
                )
            )


if __name__ == "__main__":
    port = int(os.environ.get("PORT", 5000))
    app.run(host="0.0.0.0", port=port)
